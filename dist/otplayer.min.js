!function(){"use strict";var a=function(a){if(this.container=a.container,this.buttons=a.buttons||{},this.skipTime=a.skipTime||1.5,this._rewindOnPlay=a.rewindOnPlay||!0,this._onReady=a.onReady||function(){},this._onChange=a.onChange||function(){},this._setupSpeed(a),this.source=a.source,"undefined"==typeof this.source)throw"must specify source (URL or file object) in config";if("undefined"==typeof this.container)throw"must specify container element";if(a.startpoint&&(this._startPoint=a.startpoint),this.paused=!0,this._addClickEvents(),this.source.indexOf&&this.parseYoutubeURL(this.source))this.format="youtube",$("#player-time").hide(),this._buildYoutube();else{var b;this.source.indexOf?(b=this.source,this.format="audio",this.title=b.split("/")[b.split("/").length]):(b=this._createObjectURL(this.source),this.source.type.indexOf("video")>-1?this.format="video":this.format="audio",this.title=this.source.name),this._buildMediaElement(b),this._initProgressor()}this._startPoint&&this.skipTo(this._startPoint),this._onReady()};window.oTplayer=a,a.prototype._setupSpeed=function(a){this.speedMin=a.speedMin||.5,this.speedMax=a.speedMax||2,this._setSpeedIncrement(a.speedIncrement||.25),this.buttons.speedSlider&&$(this.buttons.speedSlider).attr("min",this.speedMin).attr("max",this.speedMax)},a.prototype._setSpeedIncrement=function(a){this.speedIncrement=a,this.buttons.speedSlider&&this.buttons.speedSlider.setAttribute("step",a)},a.prototype._initProgressor=function(){"undefined"!=typeof Progressor&&(this.progressBar=new Progressor({media:this.element,bar:$("#player-hook")[0],text:this.title,time:$("#player-time")[0]}))},a.prototype._createObjectURL=function(a){return window.webkitURL?window.webkitURL.createObjectURL(a):window.URL.createObjectURL(a)},a.prototype._buildMediaElement=function(a){this.element=document.createElement(this.format),this.element.src=a,this.element.id="oTplayerEl",this.container.appendChild(this.element)},a.prototype.remove=function(){$(this.element).remove()},a.prototype.pause=function(){var a=$(this.buttons.playPause);if(a.removeClass("playing"),"youtube"===this.format)try{this._ytEl.pauseVideo()}catch(b){}else this.element.pause();this.paused=!0,this._onChange("pause")},a.prototype.play=function(){var a=$(this.buttons.playPause);if(this._rewindOnPlay&&this.skip("backwards"),a.addClass("playing"),"youtube"===this.format)try{this._ytEl.playVideo()}catch(b){}else this.element.play();this.paused=!1,this._onChange("play")},a.prototype.playPause=function(){this.paused===!1?this.pause():this.play()},a.prototype.skipTo=function(a){try{"youtube"===this.format?this._ytEl.seekTo(a):this.element.currentTime=a}catch(b){}this._onChange("skipTo")},a.prototype.setTime=a.prototype.skipTo,a.prototype.skip=function(a){var b=1;"backwards"===a&&(b=-1),this.skipTo(this.element.currentTime+this.skipTime*b)},a.prototype.speed=function(a){var b=this.element;"youtube"===this.format&&(b=this._ytEl);var c,d=this.speedMin,e=this.speedMax,f=this.speedIncrement,g=this.element.playbackRate;"up"===a&&e>g?c=g+f:"down"===a&&g>d?c=g-f:"reset"===a?c=1:"number"==typeof a&&(c=a),b&&c&&(b.playbackRate=c,b.setPlaybackRate&&b.setPlaybackRate(c),this.buttons.speedSlider&&(this.buttons.speedSlider.value=c)),this._onChange("speed")},a.prototype.getTime=function(){return"youtube"===this.format?this._ytEl.getCurrentTime():this.element.currentTime},a.prototype.getDuration=function(){return this.element.duration},a.prototype.reset=function(){this._onChange=function(){},this.speed("reset"),this.progressBar&&this.progressBar.remove(),$("#oTplayerEl").remove(),$("#player-time").show(),$("#player-hook").removeClass("progressor media-title media-titleprogressor").empty()},a.prototype.remove=a.prototype.reset,a.prototype._addClickEvents=function(){var a=this,b=this.buttons;$(b.playPause).click(function(){a.playPause()})},a.prototype.disableSpeedChange=function(){this.speed=function(){return!1},this.speedChangeDisabled=!0},a.prototype._youtubeReady=function(){function a(a){var c=a.data;2===c?b.paused=!0:b.paused=!1}var b=this,c=this.parseYoutubeURL(this.source);this._ytEl=new YT.Player("oTplayerEl",{width:"100%",videoId:c,playerVars:{disablekb:1,fs:0,rel:0,modestbranding:1},events:{onReady:this._youtubeReadyPartTwo.bind(this),onStateChange:a}}),this._setYoutubeTitle(c),this.buttons.speedSlider&&this._setSpeedIncrement(.5)},a.prototype._youtubeReadyPartTwo=function(){$(this.buttons.speedSlider).val(.5).change().val(1).change(),1===this._ytEl.getAvailablePlaybackRates()[0]&&this.disableSpeedChange(),this.element.duration=this._ytEl.getDuration(),this._onReady();var a=this;setTimeout(function(){a.play(),setTimeout(function(){a.pause(),this._startPoint&&setTimeout(function(){a.seekTo(this._startPoint)},500)},500)},1e3)},a.prototype._buildYoutube=function(a){if(this.url=a,this.element=document.createElement("div"),this.element.setAttribute("id","oTplayerEl"),document.body.appendChild(this.element),void 0===window.YT){var b=document.createElement("script");b.setAttribute("id","youtube-script"),b.src="https://www.youtube.com/iframe_api";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}else this._youtubeReady();window.onYouTubeIframeAPIReady=this._youtubeReady.bind(this)},a.prototype.parseYoutubeURL=function(a){if(a.match){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,c=a.match(b);if(c&&11===c[2].length)return c[2]}return!1},a.prototype._setYoutubeTitle=function(a){var b="http://gdata.youtube.com/feeds/api/videos/"+a+"?v=2&alt=json-in-script&callback=?";$.ajax({type:"GET",url:b,async:!1,jsonpCallback:"jsonCallback",contentType:"application/json",dataType:"jsonp",success:function(a){var b="[YouTube] "+a.entry.title.$t;this.title=b,$("#player-hook").html(b).addClass("media-title")},error:function(a){console.log(a)}})}}();